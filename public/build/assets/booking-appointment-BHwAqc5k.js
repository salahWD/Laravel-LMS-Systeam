var A=["January","February","March","April","May","June","July","August","September","October","November","December"],U=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];document.addEventListener("DOMContentLoaded",function(){var c=document.getElementById("calendar"),d=new FullCalendar.Calendar(c,{initialView:"dayGridMonth",businessHours:{daysOfWeek:allAvailableTimes.map(f=>{if(f.key!="excluded")return f.key})},height:"auto",selectable:!0,select:function(f){var g=new Date,e=f.start;if(e>g){for(var n=document.getElementById("available-times-div");n.firstChild;)n.removeChild(n.lastChild);var t=document.createElement("h4"),o=document.createTextNode(U[e.getDay()]+", "+A[e.getMonth()]+" "+e.getDate());t.appendChild(o),n.appendChild(t);let r=allAvailableTimes.filter((u,v)=>u.key==e.getDay());if(r.length>0){r.forEach(s=>{B(s).forEach(D=>{var S=document.createElement("div");S.classList.add("time-slot"),S.dataset.time=D.start;var w=document.createElement("button"),E=document.createTextNode(D.start);w.classList.add("time-btn"),w.appendChild(E),S.appendChild(w),n.appendChild(S),window.last=null,w.addEventListener("click",function(){window.last!=null&&last.parentNode.removeChild(last.parentNode.lastChild);var h=document.createElement("button"),y=document.createTextNode("Confirm");h.classList.add("confirm-btn"),h.appendChild(y),this.parentNode.appendChild(h);let p=this.textContent;h.addEventListener("click",function(){const i=new Date(`${A[e.getMonth()]} ${e.getDate()}, ${e.getFullYear()} ${H(p)}`);let l=new Date(i.toLocaleString("en-US",{timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone})),a=document.createElement("form");a.method="POST",a.action=AppointmentsUrl;let C=document.createElement("input");C.name="_token",C.value=document.querySelector("meta[name='csrf-token']").getAttribute("content"),a.appendChild(C),a.style="display: none;";let L=document.createElement("input");if(L.name="date",L.value=l.toISOString(),console.log(l.toISOString()),a.appendChild(L),has_price){let b=document.createElement("input");b.name="intentId",b.value=clientSecret,a.appendChild(b)}if(document.body.appendChild(a),has_price){document.getElementById("pages").classList.add("show-last-page");let b=l.getHours(),M=l.getMinutes(),q=l.getHours()>=12?"pm":"am",k=`${b>9?b:"0"+b}:${M>9?M:"0"+M} ${q}`;l.setMinutes(l.getMinutes()+AppointmentDuration);let I=l.getHours(),x=l.getMinutes(),N=l.getHours()>=12?"pm":"am";k=`${k} - ${I>9?I:"0"+I}:${x>9?x:"0"+x} ${N}`,document.getElementById("event-time-stamp").innerText=`${k} ${A[e.getMonth()]} ${e.getDate()}, ${e.getFullYear()}`,window.bookingForm=a}else return a.submit(),!0}),window.last=w})})});let u=e.getMonth(),v=e.getDate();const O=`${e.getFullYear()}-${u>=9?u+1:"0"+(u+1)}-${v>9?v:"0"+v}T00:00:00${P(Intl.DateTimeFormat().resolvedOptions().timeZone)}`;fetch(AppointmentsUrl+"/unavailable?date="+encodeURI(new Date(O).toISOString()),{method:"GET",headers:{"Content-Type":"application/json"}}).then(s=>s.json()).then(s=>{var T,D,S,w;if(((T=s==null?void 0:s.excluded)==null?void 0:T.length)>0||((D=s==null?void 0:s.booked)==null?void 0:D.length)>0){let E=[];if(r.forEach(h=>{const y=B(h,new Date(O));E.push(...y)}),((S=s==null?void 0:s.booked)==null?void 0:S.length)>0){const h=s.booked.map(p=>{const i=new Date(p);return i.setMinutes(i.getMinutes()+AppointmentDuration),{start:new Date(p),end:i}}),y=E.filter(p=>{const i=new Date(p.date),l=new Date(p.date);return l.setMinutes(i.getMinutes()+AppointmentDuration),h.some(a=>i>=a.start&&i<=a.end||l>=a.start&&l<=a.end||i<=a.start&&l>=a.end)});y.length>0&&y.forEach(p=>{let i=document.querySelector(`#available-times-div .time-slot[data-time="${p.start}"] button`);i.setAttribute("disabled",!0),i.parentElement.classList.add("disabled")})}if(((w=s==null?void 0:s.excluded)==null?void 0:w.length)>0){const h=s.excluded.map(p=>({start:new Date(p.from),end:new Date(p.to)})),y=E.filter(p=>{const i=new Date(p.date),l=new Date(p.date);return l.setMinutes(i.getMinutes()+AppointmentDuration),h.some(a=>i>=a.start&&i<=a.end||l>=a.start&&l<=a.end||i<=a.start&&l>=a.end)});y.length>0&&y.forEach(p=>{let i=document.querySelector(`#available-times-div .time-slot[data-time="${p.start}"] button`);i.setAttribute("disabled",!0),i.parentElement.classList.add("disabled")})}}}).catch(s=>console.error("Error:",s))}else{let u=document.createElement("div"),v=document.createTextNode("No Available Time To Book");u.appendChild(v),u.classList.add("alert","alert-warning"),n.appendChild(u)}var m=document.getElementsByClassName("container")[0];m.classList.add("time-div-active"),document.getElementById("calendar-section").style.flex="2",n.style.display="initial",d.updateSize()}else d.unselect()}});d.render()});document.getElementById("back-to-booking").addEventListener("click",function(){document.getElementById("pages").classList.remove("show-last-page")});function B(c,d=null){const[f,g]=[c.from_date.substring(2),c.to_date.substring(2)],e=Intl.DateTimeFormat().resolvedOptions().timeZone;let n;d?n=F(d,e):n=F(new Date,e);let t=new Date(`${n.substring(0,11)}${f}`),o=new Date(`${n.substring(0,11)}${g}`);t=new Date(t.toLocaleString("en-US",{timeZone:e})),o=new Date(o.toLocaleString("en-US",{timeZone:e}));const m=[];let r=new Date(t);if(o<r){let u=o;o=r,r=u}for(;r<=o;){const u=new Date(r);u.setMinutes(u.getMinutes()+AppointmentDuration),u>o&&u.setTime(o.getTime()),r<o&&m.push({date:r.toISOString(),start:_(r),end:_(u)}),r.setMinutes(r.getMinutes()+AppointmentDuration+AppointmentBufferZone)}return m}function H(c){const[d,f]=c.split(" ");let[g,e]=d.split(":");return g==="12"&&(g="00"),f.toLowerCase()==="pm"&&(g=parseInt(g,10)+12),`${g.toString().padStart(2,"0")}:${e.padStart(2,"0")}`}function _(c){const d=c.getHours(),f=c.getMinutes(),g=d>=12?"pm":"am";return`${(d%12===0?12:d%12).toString().padStart(2,"0")}:${f.toString().padStart(2,"0")} ${g}`}if(has_price){let n=function(o){const m=document.querySelector("#payment-message");m.classList.remove("hidden"),m.textContent=o,setTimeout(function(){m.classList.add("hidden"),m.textContent=""},7e3)},t=function(o){o?(document.querySelector("#submitBtn").disabled=!0,document.querySelector("#spinner").classList.remove("hidden"),document.querySelector("#button-text").classList.add("hidden")):(document.querySelector("#submitBtn").disabled=!1,document.querySelector("#spinner").classList.add("hidden"),document.querySelector("#button-text").classList.remove("hidden"))};var Z=n,W=t;const c=Stripe(stripeKey);let d;$(window).ready(function(){f(),e()}),document.querySelector("#payment-form").addEventListener("submit",g);async function f(){d=c.elements({clientSecret:clientSecretKey}),d.create("payment").mount("#payment-element")}async function g(o){o.preventDefault(),t(!0),fetch(AppointmentsUrl,{method:"POST",body:new FormData(window.bookingForm)}).then(r=>r.json()).then(r=>{console.log(r)}).catch(r=>console.error("Error:",r));const{error:m}=await c.confirmPayment({elements:d,confirmParams:{return_url:successUrl}});m&&(m.type==="card_error"||m.type==="validation_error"?n(m.message):n("An unexpected error occurred."),t(!1))}async function e(){const o=new URLSearchParams(window.location.search).get("payment_intent_client_secret");if(!o)return;const{paymentIntent:m}=await c.retrievePaymentIntent(o);switch(m.status){case"succeeded":n("Payment succeeded!");break;case"processing":n("Your payment is processing.");break;case"requires_payment_method":n("Your payment was not successful, please try again.");break;default:n("Something went wrong.");break}}}function F(c,d){const f={timeZone:d,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1},e=new Intl.DateTimeFormat("en-GB",f).formatToParts(c);return`${e.find(t=>t.type==="year").value}-${e.find(t=>t.type==="month").value}-${e.find(t=>t.type==="day").value}T${e.find(t=>t.type==="hour").value}:${e.find(t=>t.type==="minute").value}:${e.find(t=>t.type==="second").value}`}function P(c){const f=new Date().toLocaleString("en-US",{timeZone:c}),e=new Date(f).getTimezoneOffset(),n=Math.floor(Math.abs(e)/60),t=Math.abs(e)%60;return`${e<=0?"+":"-"}${String(n).padStart(2,"0")}:${String(t).padStart(2,"0")}`}
